<!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->
@if (notAvailable()) {
  <div class="not-available-container text-center">
    <p class="mat-headline-5">
      We couldn't find the project you were looking for. This is either because:
    </p>
    <ul class="mat-headline-6">
      <li>You do not have permission to view this project.</li>
      <li>The project you are looking for has been moved or deleted.</li>
      <li>
        There is an error in the URL entered into your web browser.
        Please check the URL and try again.
      </li>
    </ul>
    <button mat-fab extended type="button" color="primary"
            class="fab-btn-padding" [routerLink]="[navPath.home]">
      <mat-icon fontIcon="home" class="material-icons-outlined" />
      Go Home
    </button>
  </div>
} @else {
  @if (project) {
    <div class="article-container">
      <article class="flex-col app-gap">
        @if (project.image) {
          <picture>
            <img fill priority class="project-image"
                 [ngSrc]="project.image" [alt]="project.name" />
          </picture>
        }
        <div class="flex-col app-gap content">
          <h1 class="mat-headline-4 m-0">{{project.name}}{{project.status === ProjectStatus.DRAFT ? ' (draft)' : ''}}</h1>
          <small>{{project.views ?? 0}} {{project.views === 1 ? 'view' : 'views'}} - {{project.created.seconds * 1000 | date}}</small>
          <div class="author-follow-container">
            <div class="flex-row align-items-center app-gap">
              <aj-user-photo [image]="project.author.image" />
              <div class="flex-col justify-content-center">
                <h3 class="mat-headline-6 m-0">{{project.author.name}}</h3>
                <!-- todo: fix followers -->
                <small>15.1K followers</small>
              </div>
            </div>
            <button mat-flat-button type="button" color="primary" class="follow-btn"
                    (click)="updateFollowingStatus(user)">
              {{user?.following === true ? 'Unfollow' : 'Follow'}}
            </button>
          </div>
          <p class="mat-body-2">{{project.description}}</p>
          <mat-divider />
          <p class="ck-content" [innerHTML]="project.content"></p>
        </div>
      </article>
    </div>

    <div class="support-panel-container">
      <div id="comments"></div>
      <div id="related-projects"></div>
      <mat-tab-group color="primary" [fitInkBarToContent]="true">
        <!-- Comments -->
        <mat-tab label="Comments">
          <ng-template matTabContent>
            @if (project.allowComments) {
              <button mat-button type="button" (click)="openComments(project)">
                <mat-icon class="material-icons-outlined" fontIcon="add" /> Comment
              </button>
              <div class="comments-container">
                @for (comment of comments$ | async; track comment.id) {
                  <aj-project-detail-comment [comment]="comment"
                                             (openComments)="openComments(project)" />
                } @empty {
                  <h3 class="mat-headline-6 m-0">No comments.</h3>
                }
              </div>
            } @else {
              <h3 class="mat-headline-6 m-0">Comments are turned off.</h3>
            }
          </ng-template>
        </mat-tab>

        <!-- Related Projects -->
        <mat-tab label="Related">
          <ng-template matTabContent>
            <div class="related-projects-container">
              @if (relatedProjects$ | async; as relatedProjects) {
                @for (relatedProject of relatedProjects; track relatedProject.id) {
                  <div class="related-project" [routerLink]="[navPath.projects, relatedProject.slug]">
                    @if (relatedProject.image) {
                      <picture>
                        <img fill priority
                             [ngSrc]="relatedProject.image"
                             [alt]="relatedProject.name" />
                      </picture>
                    }
                    <span class="name">{{relatedProject.name}}</span>
                  </div>
                } @empty {
                  <h3 class="mat-headline-6 m-0">No related projects.</h3>
                }
              }
            </div>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>

    <!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->
    @if (isOwner(project, user)) {
      <button mat-fab type="button" color="accent" class="edit-btn"
              [routerLink]="[navPath.adminProjects, project.slug, 'edit']">
        <mat-icon class="material-icons-outlined" fontIcon="edit" />
      </button>
    }
  } @else {
    <aj-loading />
  }
}
