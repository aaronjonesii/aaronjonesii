import { Component, EventEmitter, Input, Output, } from '@angular/core';
import { StorageItemIconComponent, } from '../storage-item-icon/storage-item-icon.component';
import { MatTooltipModule } from '@angular/material/tooltip';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { FormatBytesPipe } from '../../pipes/format-bytes.pipe';
import { DatePipe, NgOptimizedImage } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/clipboard";
import * as i2 from "../../services/console-logger.service";
import * as i3 from "../../services/firebase-storage.service";
import * as i4 from "@angular/material/tooltip";
import * as i5 from "@angular/material/button";
import * as i6 from "@angular/material/icon";
export class StorageFilePreviewComponent {
    constructor(clipboard, cLog, storageService) {
        this.clipboard = clipboard;
        this.cLog = cLog;
        this.storageService = storageService;
        /**
         * Emits an event when the preview should be closed.
         * @event
         */
        this._close = new EventEmitter();
        /**
         * Indicates whether an error occurred while generating the file preview URL.
         */
        this.previewError = false;
    }
    ngOnChanges() {
        if (!this.item)
            return;
        /**
         * Fetches the download URL for the new file and updates the preview state.
         */
        const fileRef = this.storageService.getRef(this.item.fullPath);
        this.storageService.getDownloadURL(fileRef)
            .then((downloadURL) => {
            this.previewError = false;
            this.downloadURL = downloadURL;
        }).catch((error) => {
            this.cLog.error(`Error getting download URL for '${this.item?.name}'`, error, this.item);
        });
    }
    /**
     * Emits the '_close' event to signal that the preview should be closed.
     */
    closePreview() {
        this._close.emit(undefined);
    }
    onCopy() {
        if (this.downloadURL) {
            const success = this.clipboard.copy(this.downloadURL);
            if (success)
                this.cLog.info('Copied to clipboard');
            else
                this.cLog.info('Error copying to clipboard');
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.3", ngImport: i0, type: StorageFilePreviewComponent, deps: [{ token: i1.Clipboard }, { token: i2.ConsoleLoggerService }, { token: i3.FirebaseStorageService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.3", type: StorageFilePreviewComponent, isStandalone: true, selector: "anon-storage-file-preview", inputs: { item: "item" }, outputs: { _close: "_close" }, usesOnChanges: true, ngImport: i0, template: "@if (item) {\n  <div class=\"header\">\n    <div class=\"name\">\n      <anon-storage-item-icon [type]=\"item.type!\" [contentType]=\"item.contentType!\" />\n      <span matTooltipShowDelay=\"500\" [matTooltip]=\"item.name\">{{item.name}}</span>\n    </div>\n\n    <button mat-icon-button type=\"button\" (click)=\"closePreview()\">\n      <mat-icon fontIcon=\"close\" />\n    </button>\n  </div>\n\n  @if (downloadURL) {\n    <!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->\n    @if (item.contentType?.startsWith('image/')) {\n      <picture class=\"file-preview\">\n        <img fill [ngSrc]=\"downloadURL\" [alt]=\"item.fullPath\"\n             (error)=\"downloadURL=undefined;previewError=true\" />\n      </picture>\n      <!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->\n    } @else if (item.contentType?.startsWith('video/')) {\n      <video class=\"file-preview\" controls autoplay loop>\n        <source [type]=\"item.contentType\" [src]=\"downloadURL\"\n                (error)=\"downloadURL=undefined;previewError=true\"/>\n      </video>\n    }\n\n    <div class=\"btn-container\">\n      <div class=\"download-btn\">\n        <a mat-stroked-button type=\"button\" color=\"primary\" target=\"_blank\" [href]=\"downloadURL\">\n          <mat-icon fontIcon=\"download\" />\n          <span>Download</span>\n        </a>\n      </div>\n\n      <div class=\"copy-btn\">\n        <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"onCopy()\">\n          <mat-icon fontIcon=\"file_copy\" />\n          <span>Copy</span>\n        </button>\n      </div>\n    </div>\n  }\n  @if (previewError) {\n    <h3 class=\"file-preview\">Preview Not Available.</h3>\n  }\n\n  <dl class=\"metadata\">\n    <dt>Name</dt>\n    <dd><a class=\"download-link\" target=\"_blank\" [href]=\"downloadURL\">{{item.name}}</a></dd>\n\n    <dt>Size</dt>\n    <dd>{{item.size | formatBytes}}</dd>\n\n    <dt>Type</dt>\n    <dd>{{item.contentType}}</dd>\n\n    <dt>Created</dt>\n    <dd>{{item.timeCreated | date:'short'}}</dd>\n\n    <dt>Last modified</dt>\n    <dd>{{item.updated | date:'short'}}</dd>\n  </dl>\n}\n", styles: [":host{display:block;margin-left:-1.5rem;flex-shrink:0;border-left-width:1px;border-left-style:solid;height:100%}.header{display:flex;justify-content:space-between;align-items:center;padding:.5rem 1.5rem}.header .name{display:flex;align-items:center;overflow:hidden}.header .name span{display:inline-block;flex-grow:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-preview{display:grid;place-content:center;max-width:100%;max-height:250px;padding:.5rem 1.5rem;box-sizing:border-box}.file-preview img{position:relative!important}.metadata{padding:0 1.5rem .5rem}.download-link{overflow-wrap:break-word}.btn-container{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}\n"], dependencies: [{ kind: "component", type: StorageItemIconComponent, selector: "anon-storage-item-icon", inputs: ["type", "contentType"] }, { kind: "ngmodule", type: MatTooltipModule }, { kind: "directive", type: i4.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "ngmodule", type: MatButtonModule }, { kind: "component", type: i5.MatAnchor, selector: "a[mat-button], a[mat-raised-button], a[mat-flat-button], a[mat-stroked-button]", exportAs: ["matButton", "matAnchor"] }, { kind: "component", type: i5.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", exportAs: ["matButton"] }, { kind: "component", type: i5.MatIconButton, selector: "button[mat-icon-button]", exportAs: ["matButton"] }, { kind: "ngmodule", type: MatIconModule }, { kind: "component", type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "pipe", type: FormatBytesPipe, name: "formatBytes" }, { kind: "pipe", type: DatePipe, name: "date" }, { kind: "directive", type: NgOptimizedImage, selector: "img[ngSrc]", inputs: ["ngSrc", "ngSrcset", "sizes", "width", "height", "loading", "priority", "loaderParams", "disableOptimizedSrcset", "fill", "placeholder", "placeholderConfig", "src", "srcset"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.3", ngImport: i0, type: StorageFilePreviewComponent, decorators: [{
            type: Component,
            args: [{ selector: 'anon-storage-file-preview', standalone: true, imports: [
                        StorageItemIconComponent,
                        MatTooltipModule,
                        MatButtonModule,
                        MatIconModule,
                        FormatBytesPipe,
                        DatePipe,
                        NgOptimizedImage,
                    ], template: "@if (item) {\n  <div class=\"header\">\n    <div class=\"name\">\n      <anon-storage-item-icon [type]=\"item.type!\" [contentType]=\"item.contentType!\" />\n      <span matTooltipShowDelay=\"500\" [matTooltip]=\"item.name\">{{item.name}}</span>\n    </div>\n\n    <button mat-icon-button type=\"button\" (click)=\"closePreview()\">\n      <mat-icon fontIcon=\"close\" />\n    </button>\n  </div>\n\n  @if (downloadURL) {\n    <!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->\n    @if (item.contentType?.startsWith('image/')) {\n      <picture class=\"file-preview\">\n        <img fill [ngSrc]=\"downloadURL\" [alt]=\"item.fullPath\"\n             (error)=\"downloadURL=undefined;previewError=true\" />\n      </picture>\n      <!-- eslint-disable-next-line @angular-eslint/template/no-call-expression -->\n    } @else if (item.contentType?.startsWith('video/')) {\n      <video class=\"file-preview\" controls autoplay loop>\n        <source [type]=\"item.contentType\" [src]=\"downloadURL\"\n                (error)=\"downloadURL=undefined;previewError=true\"/>\n      </video>\n    }\n\n    <div class=\"btn-container\">\n      <div class=\"download-btn\">\n        <a mat-stroked-button type=\"button\" color=\"primary\" target=\"_blank\" [href]=\"downloadURL\">\n          <mat-icon fontIcon=\"download\" />\n          <span>Download</span>\n        </a>\n      </div>\n\n      <div class=\"copy-btn\">\n        <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"onCopy()\">\n          <mat-icon fontIcon=\"file_copy\" />\n          <span>Copy</span>\n        </button>\n      </div>\n    </div>\n  }\n  @if (previewError) {\n    <h3 class=\"file-preview\">Preview Not Available.</h3>\n  }\n\n  <dl class=\"metadata\">\n    <dt>Name</dt>\n    <dd><a class=\"download-link\" target=\"_blank\" [href]=\"downloadURL\">{{item.name}}</a></dd>\n\n    <dt>Size</dt>\n    <dd>{{item.size | formatBytes}}</dd>\n\n    <dt>Type</dt>\n    <dd>{{item.contentType}}</dd>\n\n    <dt>Created</dt>\n    <dd>{{item.timeCreated | date:'short'}}</dd>\n\n    <dt>Last modified</dt>\n    <dd>{{item.updated | date:'short'}}</dd>\n  </dl>\n}\n", styles: [":host{display:block;margin-left:-1.5rem;flex-shrink:0;border-left-width:1px;border-left-style:solid;height:100%}.header{display:flex;justify-content:space-between;align-items:center;padding:.5rem 1.5rem}.header .name{display:flex;align-items:center;overflow:hidden}.header .name span{display:inline-block;flex-grow:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-preview{display:grid;place-content:center;max-width:100%;max-height:250px;padding:.5rem 1.5rem;box-sizing:border-box}.file-preview img{position:relative!important}.metadata{padding:0 1.5rem .5rem}.download-link{overflow-wrap:break-word}.btn-container{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}\n"] }]
        }], ctorParameters: () => [{ type: i1.Clipboard }, { type: i2.ConsoleLoggerService }, { type: i3.FirebaseStorageService }], propDecorators: { item: [{
                type: Input
            }], _close: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS1maWxlLXByZXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW5ndWxhci1maXJlYmFzZS1zdG9yYWdlLW1hbmFnZXIvc3JjL2xpYi9jb21wb25lbnRzL3N0b3JhZ2UtZmlsZS1wcmV2aWV3L3N0b3JhZ2UtZmlsZS1wcmV2aWV3LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItZmlyZWJhc2Utc3RvcmFnZS1tYW5hZ2VyL3NyYy9saWIvY29tcG9uZW50cy9zdG9yYWdlLWZpbGUtcHJldmlldy9zdG9yYWdlLWZpbGUtcHJldmlldy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxHQUNsRCxNQUFNLGVBQWUsQ0FBQztBQU12QixPQUFPLEVBQ0wsd0JBQXdCLEdBQ3pCLE1BQU0sa0RBQWtELENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7OztBQW1CN0QsTUFBTSxPQUFPLDJCQUEyQjtJQXdCdEMsWUFDVSxTQUFvQixFQUNwQixJQUEwQixFQUMxQixjQUFzQztRQUZ0QyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLFNBQUksR0FBSixJQUFJLENBQXNCO1FBQzFCLG1CQUFjLEdBQWQsY0FBYyxDQUF3QjtRQXBCaEQ7OztXQUdHO1FBRU0sV0FBTSxHQUE0QixJQUFJLFlBQVksRUFBYSxDQUFDO1FBT3pFOztXQUVHO1FBQ0gsaUJBQVksR0FBRyxLQUFLLENBQUM7SUFNbEIsQ0FBQztJQUVKLFdBQVc7UUFDVCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7WUFBRSxPQUFPO1FBRXZCOztXQUVHO1FBQ0gsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUM7YUFDeEMsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7WUFDMUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBb0IsRUFBRSxFQUFFO1lBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUNiLG1DQUFtQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksR0FBRyxFQUNyRCxLQUFLLEVBQ0wsSUFBSSxDQUFDLElBQUksQ0FDVixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZO1FBQ1YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELE1BQU07UUFDSixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNyQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdEQsSUFBSSxPQUFPO2dCQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7O2dCQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1FBQ3BELENBQUM7SUFDSCxDQUFDOzhHQS9EVSwyQkFBMkI7a0dBQTNCLDJCQUEyQixtS0NsQ3hDLGlvRUFnRUEsZ3ZCRHZDSSx3QkFBd0IsbUdBQ3hCLGdCQUFnQiw0VEFDaEIsZUFBZSxxZkFDZixhQUFhLCtLQUNiLGVBQWUsK0NBQ2YsUUFBUSw2Q0FDUixnQkFBZ0I7OzJGQUdQLDJCQUEyQjtrQkFmdkMsU0FBUzsrQkFDRSwyQkFBMkIsY0FHekIsSUFBSSxXQUNQO3dCQUNQLHdCQUF3Qjt3QkFDeEIsZ0JBQWdCO3dCQUNoQixlQUFlO3dCQUNmLGFBQWE7d0JBQ2IsZUFBZTt3QkFDZixRQUFRO3dCQUNSLGdCQUFnQjtxQkFDakI7c0pBT0QsSUFBSTtzQkFESCxLQUFLO2dCQVFHLE1BQU07c0JBRGQsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3RvcmFnZUZpbGUgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7XG4gIEZpcmViYXNlU3RvcmFnZVNlcnZpY2UsXG59IGZyb20gJy4uLy4uL3NlcnZpY2VzL2ZpcmViYXNlLXN0b3JhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBGaXJlYmFzZUVycm9yIH0gZnJvbSAnQGFuZ3VsYXIvZmlyZS9hcHAvZmlyZWJhc2UnO1xuaW1wb3J0IHtcbiAgU3RvcmFnZUl0ZW1JY29uQ29tcG9uZW50LFxufSBmcm9tICcuLi9zdG9yYWdlLWl0ZW0taWNvbi9zdG9yYWdlLWl0ZW0taWNvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgTWF0VG9vbHRpcE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3Rvb2x0aXAnO1xuaW1wb3J0IHsgTWF0QnV0dG9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYnV0dG9uJztcbmltcG9ydCB7IE1hdEljb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9pY29uJztcbmltcG9ydCB7IEZvcm1hdEJ5dGVzUGlwZSB9IGZyb20gJy4uLy4uL3BpcGVzL2Zvcm1hdC1ieXRlcy5waXBlJztcbmltcG9ydCB7IERhdGVQaXBlLCBOZ09wdGltaXplZEltYWdlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbnNvbGVMb2dnZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29uc29sZS1sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBDbGlwYm9hcmQgfSBmcm9tICdAYW5ndWxhci9jZGsvY2xpcGJvYXJkJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYW5vbi1zdG9yYWdlLWZpbGUtcHJldmlldycsXG4gIHRlbXBsYXRlVXJsOiAnLi9zdG9yYWdlLWZpbGUtcHJldmlldy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsOiAnLi9zdG9yYWdlLWZpbGUtcHJldmlldy5jb21wb25lbnQuc2NzcycsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBTdG9yYWdlSXRlbUljb25Db21wb25lbnQsXG4gICAgTWF0VG9vbHRpcE1vZHVsZSxcbiAgICBNYXRCdXR0b25Nb2R1bGUsXG4gICAgTWF0SWNvbk1vZHVsZSxcbiAgICBGb3JtYXRCeXRlc1BpcGUsXG4gICAgRGF0ZVBpcGUsXG4gICAgTmdPcHRpbWl6ZWRJbWFnZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgU3RvcmFnZUZpbGVQcmV2aWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgLyoqXG4gICAqIFRoZSBTdG9yYWdlRmlsZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBmaWxlIHRvIHByZXZpZXcuXG4gICAqL1xuICBASW5wdXQoKVxuICBpdGVtPzogU3RvcmFnZUZpbGU7XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFuIGV2ZW50IHdoZW4gdGhlIHByZXZpZXcgc2hvdWxkIGJlIGNsb3NlZC5cbiAgICogQGV2ZW50XG4gICAqL1xuICBAT3V0cHV0KClcbiAgcmVhZG9ubHkgX2Nsb3NlOiBFdmVudEVtaXR0ZXI8dW5kZWZpbmVkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dW5kZWZpbmVkPigpO1xuXG4gIC8qKlxuICAgKiBUaGUgZG93bmxvYWQgVVJMIGZvciB0aGUgcHJldmlld2VkIGZpbGUgKGlmIHN1Y2Nlc3NmdWxseSBnZW5lcmF0ZWQpLlxuICAgKi9cbiAgZG93bmxvYWRVUkw/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIGFuIGVycm9yIG9jY3VycmVkIHdoaWxlIGdlbmVyYXRpbmcgdGhlIGZpbGUgcHJldmlldyBVUkwuXG4gICAqL1xuICBwcmV2aWV3RXJyb3IgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNsaXBib2FyZDogQ2xpcGJvYXJkLFxuICAgIHByaXZhdGUgY0xvZzogQ29uc29sZUxvZ2dlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzdG9yYWdlU2VydmljZTogRmlyZWJhc2VTdG9yYWdlU2VydmljZSxcbiAgKSB7fVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIGlmICghdGhpcy5pdGVtKSByZXR1cm47XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaGVzIHRoZSBkb3dubG9hZCBVUkwgZm9yIHRoZSBuZXcgZmlsZSBhbmQgdXBkYXRlcyB0aGUgcHJldmlldyBzdGF0ZS5cbiAgICAgKi9cbiAgICBjb25zdCBmaWxlUmVmID0gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRSZWYodGhpcy5pdGVtLmZ1bGxQYXRoKTtcbiAgICB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldERvd25sb2FkVVJMKGZpbGVSZWYpXG4gICAgICAudGhlbigoZG93bmxvYWRVUkwpID0+IHtcbiAgICAgICAgdGhpcy5wcmV2aWV3RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kb3dubG9hZFVSTCA9IGRvd25sb2FkVVJMO1xuICAgICAgfSkuY2F0Y2goKGVycm9yOiBGaXJlYmFzZUVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMuY0xvZy5lcnJvcihcbiAgICAgICAgICBgRXJyb3IgZ2V0dGluZyBkb3dubG9hZCBVUkwgZm9yICcke3RoaXMuaXRlbT8ubmFtZX0nYCxcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICB0aGlzLml0ZW0sXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUgJ19jbG9zZScgZXZlbnQgdG8gc2lnbmFsIHRoYXQgdGhlIHByZXZpZXcgc2hvdWxkIGJlIGNsb3NlZC5cbiAgICovXG4gIGNsb3NlUHJldmlldygpIHtcbiAgICB0aGlzLl9jbG9zZS5lbWl0KHVuZGVmaW5lZCk7XG4gIH1cblxuICBvbkNvcHkoKSB7XG4gICAgaWYgKHRoaXMuZG93bmxvYWRVUkwpIHtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSB0aGlzLmNsaXBib2FyZC5jb3B5KHRoaXMuZG93bmxvYWRVUkwpO1xuICAgICAgaWYgKHN1Y2Nlc3MpIHRoaXMuY0xvZy5pbmZvKCdDb3BpZWQgdG8gY2xpcGJvYXJkJyk7XG4gICAgICBlbHNlIHRoaXMuY0xvZy5pbmZvKCdFcnJvciBjb3B5aW5nIHRvIGNsaXBib2FyZCcpO1xuICAgIH1cbiAgfVxufVxuIiwiQGlmIChpdGVtKSB7XG4gIDxkaXYgY2xhc3M9XCJoZWFkZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwibmFtZVwiPlxuICAgICAgPGFub24tc3RvcmFnZS1pdGVtLWljb24gW3R5cGVdPVwiaXRlbS50eXBlIVwiIFtjb250ZW50VHlwZV09XCJpdGVtLmNvbnRlbnRUeXBlIVwiIC8+XG4gICAgICA8c3BhbiBtYXRUb29sdGlwU2hvd0RlbGF5PVwiNTAwXCIgW21hdFRvb2x0aXBdPVwiaXRlbS5uYW1lXCI+e3tpdGVtLm5hbWV9fTwvc3Bhbj5cbiAgICA8L2Rpdj5cblxuICAgIDxidXR0b24gbWF0LWljb24tYnV0dG9uIHR5cGU9XCJidXR0b25cIiAoY2xpY2spPVwiY2xvc2VQcmV2aWV3KClcIj5cbiAgICAgIDxtYXQtaWNvbiBmb250SWNvbj1cImNsb3NlXCIgLz5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG5cbiAgQGlmIChkb3dubG9hZFVSTCkge1xuICAgIDwhLS0gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC90ZW1wbGF0ZS9uby1jYWxsLWV4cHJlc3Npb24gLS0+XG4gICAgQGlmIChpdGVtLmNvbnRlbnRUeXBlPy5zdGFydHNXaXRoKCdpbWFnZS8nKSkge1xuICAgICAgPHBpY3R1cmUgY2xhc3M9XCJmaWxlLXByZXZpZXdcIj5cbiAgICAgICAgPGltZyBmaWxsIFtuZ1NyY109XCJkb3dubG9hZFVSTFwiIFthbHRdPVwiaXRlbS5mdWxsUGF0aFwiXG4gICAgICAgICAgICAgKGVycm9yKT1cImRvd25sb2FkVVJMPXVuZGVmaW5lZDtwcmV2aWV3RXJyb3I9dHJ1ZVwiIC8+XG4gICAgICA8L3BpY3R1cmU+XG4gICAgICA8IS0tIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvdGVtcGxhdGUvbm8tY2FsbC1leHByZXNzaW9uIC0tPlxuICAgIH0gQGVsc2UgaWYgKGl0ZW0uY29udGVudFR5cGU/LnN0YXJ0c1dpdGgoJ3ZpZGVvLycpKSB7XG4gICAgICA8dmlkZW8gY2xhc3M9XCJmaWxlLXByZXZpZXdcIiBjb250cm9scyBhdXRvcGxheSBsb29wPlxuICAgICAgICA8c291cmNlIFt0eXBlXT1cIml0ZW0uY29udGVudFR5cGVcIiBbc3JjXT1cImRvd25sb2FkVVJMXCJcbiAgICAgICAgICAgICAgICAoZXJyb3IpPVwiZG93bmxvYWRVUkw9dW5kZWZpbmVkO3ByZXZpZXdFcnJvcj10cnVlXCIvPlxuICAgICAgPC92aWRlbz5cbiAgICB9XG5cbiAgICA8ZGl2IGNsYXNzPVwiYnRuLWNvbnRhaW5lclwiPlxuICAgICAgPGRpdiBjbGFzcz1cImRvd25sb2FkLWJ0blwiPlxuICAgICAgICA8YSBtYXQtc3Ryb2tlZC1idXR0b24gdHlwZT1cImJ1dHRvblwiIGNvbG9yPVwicHJpbWFyeVwiIHRhcmdldD1cIl9ibGFua1wiIFtocmVmXT1cImRvd25sb2FkVVJMXCI+XG4gICAgICAgICAgPG1hdC1pY29uIGZvbnRJY29uPVwiZG93bmxvYWRcIiAvPlxuICAgICAgICAgIDxzcGFuPkRvd25sb2FkPC9zcGFuPlxuICAgICAgICA8L2E+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cImNvcHktYnRuXCI+XG4gICAgICAgIDxidXR0b24gbWF0LXN0cm9rZWQtYnV0dG9uIHR5cGU9XCJidXR0b25cIiBjb2xvcj1cInByaW1hcnlcIiAoY2xpY2spPVwib25Db3B5KClcIj5cbiAgICAgICAgICA8bWF0LWljb24gZm9udEljb249XCJmaWxlX2NvcHlcIiAvPlxuICAgICAgICAgIDxzcGFuPkNvcHk8L3NwYW4+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIH1cbiAgQGlmIChwcmV2aWV3RXJyb3IpIHtcbiAgICA8aDMgY2xhc3M9XCJmaWxlLXByZXZpZXdcIj5QcmV2aWV3IE5vdCBBdmFpbGFibGUuPC9oMz5cbiAgfVxuXG4gIDxkbCBjbGFzcz1cIm1ldGFkYXRhXCI+XG4gICAgPGR0Pk5hbWU8L2R0PlxuICAgIDxkZD48YSBjbGFzcz1cImRvd25sb2FkLWxpbmtcIiB0YXJnZXQ9XCJfYmxhbmtcIiBbaHJlZl09XCJkb3dubG9hZFVSTFwiPnt7aXRlbS5uYW1lfX08L2E+PC9kZD5cblxuICAgIDxkdD5TaXplPC9kdD5cbiAgICA8ZGQ+e3tpdGVtLnNpemUgfCBmb3JtYXRCeXRlc319PC9kZD5cblxuICAgIDxkdD5UeXBlPC9kdD5cbiAgICA8ZGQ+e3tpdGVtLmNvbnRlbnRUeXBlfX08L2RkPlxuXG4gICAgPGR0PkNyZWF0ZWQ8L2R0PlxuICAgIDxkZD57e2l0ZW0udGltZUNyZWF0ZWQgfCBkYXRlOidzaG9ydCd9fTwvZGQ+XG5cbiAgICA8ZHQ+TGFzdCBtb2RpZmllZDwvZHQ+XG4gICAgPGRkPnt7aXRlbS51cGRhdGVkIHwgZGF0ZTonc2hvcnQnfX08L2RkPlxuICA8L2RsPlxufVxuIl19